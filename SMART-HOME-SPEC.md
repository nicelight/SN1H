# SMART-HOME-SPEC.md

## üß± 1. –ê–ø–ø–∞—Ä–∞—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-----------|
| CPU | Intel i7 12-–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è (–±–µ–∑ iGPU) |
| GPU | NVIDIA RTX 3060 Ti (8 GB VRAM) |
| RAM | 32 GB |
| SSD | 510 GB (—Å–∏—Å—Ç–µ–º–∞ Debian 13 + XFCE + Docker + KVM + –≤–∏—Ä—Ç—É–∞–ª–∫–∏) |
| HDD | 2 TB (ext4, —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ `/srv/home-automation`) ‚Äî –¥–∞–Ω–Ω—ã–µ —É–º–Ω–æ–≥–æ –¥–æ–º–∞ |
| –û–° | Debian 13 (XFCE) |
| BIOS/Boot | UEFI, GPT —Ä–∞–∑–º–µ—Ç–∫–∞ |

## üåê 2. –°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç—å: `192.168.10.0/24`
- –°–µ—Ä–≤–µ—Ä Debian: `192.168.10.140` (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π IP)
- –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ HAOS: `192.168.10.53`
- –ë—Ä–∏–¥–∂ KVM: `br0` (—Å–≤—è–∑–∞–Ω —Å –æ—Å–Ω–æ–≤–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º)
- –î–æ—Å—Ç—É–ø:  
  - Home Assistant ‚Üí `http://192.168.10.53:8123`  
  - Wyoming Whisper GPU ‚Üí `tcp://192.168.10.140:10300`

## üê≥ 3. Docker-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ compose-—Ñ–∞–π–ª–æ–≤ (SSD)**  
`/opt/home-automation/`

**–î–∞–Ω–Ω—ã–µ (HDD)**  
`/srv/home-automation/`

### –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

| –°–µ—Ä–≤–∏—Å | –û–±—Ä–∞–∑ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°–µ—Ç—å | GPU | –ü—É—Ç—å –¥–∞–Ω–Ω—ã—Ö |
|---------|--------|-------------|------|-----|-------------|
| **Samba** | `dperson/samba` | –û–±—â–∏–π –¥–æ—Å—Ç—É–ø –ø–æ SMB –∫ —Ñ–∞–π–ª–∞–º —É–º–Ω–æ–≥–æ –¥–æ–º–∞ | host | ‚Äì | `/srv/home-automation/samba/share` |
| **Wyoming Whisper GPU** | `ghcr.io/slackr31337/wyoming-whisper-gpu:latest` | STT-—Å–µ—Ä–≤–∏—Å –Ω–∞ –±–∞–∑–µ faster-whisper –¥–ª—è Home Assistant | host:10300 | ‚úÖ | `/srv/home-automation/wyoming-whisper` |

## üß© 4. Home Assistant OS (–≤ KVM)
- VM –Ω–∞–∑–≤–∞–Ω–∏–µ: `haos-25`  
- –¢–∏–ø: KVM/QEMU (–º–æ—Å—Ç `br0`)  
- IP: `192.168.10.53`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:  
  - **Wyoming** (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ STT –Ω–∞ 192.168.10.140:10300)  
  - **MQTT** (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–¥–¥–æ–Ω Mosquitto)  
  - **Samba addon ‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** (–∑–∞–º–µ–Ω—ë–Ω –¥–æ–∫–µ—Ä-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –Ω–∞ Debian)  
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ HA Companion –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ (Assist pipeline).

## üß† 5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
```text
[ESP32 Mic Nodes]  ‚Üí (MQTT/WiFi)
                              \
                               ‚Üí  [HAOS VM @192.168.10.53]
                                     | Assist Pipeline
                                     ‚Üì
                               [Wyoming Whisper GPU @192.168.10.140:10300]
                                     |
                                     ‚Üí faster-whisper ‚Üí CUDA (3060 Ti)
                              
[Frigate] (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è) ‚Üí GPU –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ ‚Üí MQTT ‚Üí HAOS
[Samba] ‚Üí –æ–±—â–∏–µ –ø–∞–ø–∫–∏ / –∞—Ä—Ö–∏–≤—ã –≤–∏–¥–µ–æ ‚Üí —Å–µ—Ç—å
```

## ‚öôÔ∏è 6. –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞
- Docker –¥–µ–º–æ–Ω: `systemctl enable docker`
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å `restart: unless-stopped` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ–±—É—Ç–∞.
- VM HAOS –∞–≤—Ç–æ—Å—Ç–∞—Ä—Ç—É–µ—Ç —á–µ—Ä–µ–∑ libvirt/KVM.

## üìÇ 7. –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
```text
/opt/home-automation/
 ‚îú‚îÄ‚îÄ samba/
 ‚îÇ    ‚îî‚îÄ‚îÄ docker-compose.yml
 ‚îú‚îÄ‚îÄ wyoming-whisper/
 ‚îÇ    ‚îî‚îÄ‚îÄ docker-compose.yml
 ‚îî‚îÄ‚îÄ frigate/        (—Ä–µ–∑–µ—Ä–≤ –ø–æ–¥ –±—É–¥—É—â–µ–µ)

/srv/home-automation/
 ‚îú‚îÄ‚îÄ samba/share/
 ‚îú‚îÄ‚îÄ wyoming-whisper/
 ‚îî‚îÄ‚îÄ frigate/{config,media,db}/
```

## 8. –¢–æ–ø–æ–ª–æ–≥–∏—è —Å–µ—Ç–∏
```mermaid 
flowchart LR
  %% –¢–æ–ø–æ–ª–æ–≥–∏—è —Å–µ—Ç–∏

  U[–ê–ø–ª–∏–Ω–∫]

  subgraph L[–õ–µ–≤—ã–π —É–∑–µ–ª]
    TTL[TTL —Ä–æ—É—Ç–µ—Ä]
    SW[TP-Link —Å–≤–∏—á]
    RJ[PoE Ruijie —Å–≤–∏—á]

    subgraph PX[–°–µ—Ä–≤–µ—Ä ProxMox]
      SRV[–°–µ—Ä–≤–µ—Ä]
      HA[HA 10.141]
    end
  end

  subgraph R[–ü—Ä–∞–≤—ã–π —É–∑–µ–ª]
    KN[–†–æ—É—Ç–µ—Ä Keenetic]
  end

  CAM[–ö–∞–º–µ—Ä–∞]

  %% –°–≤—è–∑–∏
  U --> TTL
  TTL --- KN
  KN --- SW
  SW --- SRV
  SW --- RJ
  RJ --- CAM

```


## üöÄ 8. TODO / Planned
| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å |
|--------|---------|
| GPU-Frigate –≤ Docker + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ HA —á–µ—Ä–µ–∑ MQTT | üïì –ø–ª–∞–Ω |
| HTTPS –¥–ª—è HAOS (—á–µ—Ä–µ–∑ NGINX Proxy –∏–ª–∏ Let‚Äôs Encrypt) | üïì –ø–ª–∞–Ω |
| –†–µ–∑–µ—Ä–≤ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö (HDD ‚Üí Samba/NAS/Cloud) | üïì –ø–ª–∞–Ω |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GPU/—Å–∏—Å—Ç–µ–º—ã (Prometheus + Grafana) | üïì –ø–ª–∞–Ω |
| DHCP vs Static IP —Ä–µ–≤–∏–∑–∏—è –¥–ª—è –ø—Ä–æ–¥-—Å–µ—Ç–∏ | ‚úÖ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ (192.168.10.140) |

## üìë 9. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—Ä–æ–≤–µ—Ä–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------------|-----------|-----------|
| GPU-CUDA –≤ Docker | `docker exec -it wyoming-whisper nvidia-smi` | ‚úÖ –≤–∏–¥–∏—Ç 3060 Ti |
| –ü–æ—Ä—Ç STT | `ss -tulnp | grep 10300` | ‚úÖ LISTEN |
| HAOS ‚Üî Wyoming | —Ç–µ—Å—Ç Assist —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | ‚úÖ –æ—Ç–ª–∏—á–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç |
| Samba —à–∞—Ä—ã | `smbclient -L localhost -U admin` | ‚úÖ –≤–∏–¥–Ω—ã |
