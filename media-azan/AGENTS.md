# Правила агентов

## Язык и стиль
- Общение и документация на русском, допускаются устойчивые англ. термины.
- Работаем по принципу KISS. Не усложняй, производи только критически необходимые проверки и валидации.
- Философия разработки: AI-driven + Spec Driven с declarative architecture.

## Роли
- Пользователь — тимлид проекта: формулирует цели, утверждает архитектуру и приоритеты, направляет агентов.
- Агенты — исполнители: разрабатывают код только агенты, они проектируют архитектуру, генерируют декларации, спецификации создают и декомпозируют задачи, но делают это только после согласования ключевых развилок с тимлидом.

## Сабагенты
- `@memspec` (описание в `.opencode/agents/memspec.md`) — ведение memory bank и деклараций.
- `@inceptor` (описание в `.opencode/agents/inceptor.md`) — формирование правил для `AGENTS.md`.

## Политика задач
- Любой имплементационный шаг требует задачи с префиксом `CONSULT` или `REFLECT` в `.memory/TASKS.md`.
- Реализация допускается только после консультации с тимлидом.
- Во время выполнения любой задачи регулярно оценивай, не появились ли неоднозначности или развилки, способные усложнить проект; при их обнаружении приостанови реализацию и инициируй консультацию с тимлидом.
- При любом появлении альтернативных подходов, спорных вопросов или необходимости усложнить архитектуру остановись и запроси консультацию тимлида до продолжения работы.
- Перед запросом фиксируй контекст и вопросы в `.memory/TASKS.md` (префиксы `CONSULT`/`REFLECT`) и в `.memory/WORKLOG.md`.

## Практика CONSULT/REFLECT
- Каждую нетривиальную развилку предваряй задачей `CONSULT — …` с описанием вопросов к тимлиду.
- Если требуется осмыслить риски/альтернативы или подготовить аргументы до разговора, заводи `REFLECT — …`.
- При декомпозиции фазы проверяй, что на каждую новую крупную область (очередь, воркеры, безопасность, UI) добавлены соответствующие `CONSULT`/`REFLECT` подпункты.
- После консультации перенеси решения в `.memory/WORKLOG.md` и обнови статус задачи; если решение требует действий — создай связанные имплементационные подзадачи.
- Под каждую ветку Kanban заводи служебный узел управления `US {id}.GOV` (или `US {id}.Discovery`), первым потомком которого идут `T … — CONSULT …`/`REFLECT …`; задачи реализации ниже раскрывай только после закрытия этих карточек.
- В `.memory/TASKS.md` храни шаблон блока с `GOV`‑узлом и копируй его при создании новых веток.
- Перед стартом дочерних `US/T` проверяй, что родительский `GOV`‑узел отмечен `[x]`; пока он `[ ]`, зависимые карточки остаются «не начаты».

## Memory bank и декларации
- В начале работы читать документы из `.memory`.
- Спецификации храним в `.memory`, декларации — в `decl`.
- Любые изменения публичного поведения/интерфейсов — через `@memspec`.

## Отчетность
- По завершении задачи обновлять `.memory/WORKLOG.md` и `.memory/CODEMAP.md`.
- Фиксировать решения в `.memory/DECISIONS.md`.
- К отчету приложить: команды запуска тестов/линта и краткие логи/снимки версий контрактов.

## Канонический процесс Spec Driven Dev + Decl AI-first
1) Любые изменения поведения/публичных интерфейсов — сначала `@memspec` и только через `@memspec`.
2) Добавь/обнови unit + contract‑тесты если необходимо; прогон pre‑commit чек‑листа (см. CONTEXT).
3) Внеси минимально достаточные изменения кода.

## Документы памяти
Агент поддерживает следующие файлы в `.memory`:
- `BRIEF.md`
- `PRD.md`
- `SPEC.md`
- `ARCHITECTURE.md`
- `DECISIONS.md`
- `TASKS.md`
- `RUNBOOK.md`
- `GLOSSARY.md`

## Кодировочная дисциплина
- Все текстовые артефакты в UTF‑8 без BOM; не упрощай содержимое ради ASCII.
- После правок проверяй, что файл читается как UTF‑8 (`py -X utf8 -c "from pathlib import Path; Path(...).read_text(encoding='utf-8')"`) и что `git diff` не содержит «Р…» артефактов.
